\documentclass[11pt]{article}

    \usepackage[breakable]{tcolorbox}
    \usepackage{parskip} % Stop auto-indenting (to mimic markdown behaviour)
    

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % Keep aspect ratio if custom image width or height is specified
    \setkeys{Gin}{keepaspectratio}
    % Maintain compatibility with old templates. Remove in nbconvert 6.0
    \let\Oldincludegraphics\includegraphics
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionFormat{nocaption}{}
    \captionsetup{format=nocaption,aboveskip=0pt,belowskip=0pt}

    \usepackage{float}
    \floatplacement{figure}{H} % forces figures to be placed at the correct location
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro

    \usepackage{iftex}
    \ifPDFTeX
        \usepackage[T1]{fontenc}
        \IfFileExists{alphabeta.sty}{
              \usepackage{alphabeta}
          }{
              \usepackage[mathletters]{ucs}
              \usepackage[utf8x]{inputenc}
          }
    \else
        \usepackage{fontspec}
        \usepackage{unicode-math}
    \fi

    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics
                         % to support a larger range
    \makeatletter % fix for old versions of grffile with XeLaTeX
    \@ifpackagelater{grffile}{2019/11/01}
    {
      % Do nothing on new versions
    }
    {
      \def\Gread@@xetex#1{%
        \IfFileExists{"\Gin@base".bb}%
        {\Gread@eps{\Gin@base.bb}}%
        {\Gread@@xetex@aux#1}%
      }
    }
    \makeatother
    \usepackage[Export]{adjustbox} % Used to constrain images to a maximum size
    \adjustboxset{max size={0.9\linewidth}{0.9\paperheight}}

    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    % The default LaTeX title has an obnoxious amount of whitespace. By default,
    % titling removes some of it. It also provides customization options.
    \usepackage{titling}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage{array}     % table support for pandoc >= 2.11.3
    \usepackage{calc}      % table minipage width calculation for pandoc >= 2.11.1
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    \usepackage{soul}      % strikethrough (\st) support for pandoc >= 3.0.0
    \usepackage{mathrsfs}
    

    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}
    \definecolor{ansi-default-inverse-fg}{HTML}{FFFFFF}
    \definecolor{ansi-default-inverse-bg}{HTML}{000000}

    % common color for the border for error outputs.
    \definecolor{outerrorbackground}{HTML}{FFDFDF}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}

    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}


    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatibility definitions
    \def\gt{>}
    \def\lt{<}
    \let\Oldtex\TeX
    \let\Oldlatex\LaTeX
    \renewcommand{\TeX}{\textrm{\Oldtex}}
    \renewcommand{\LaTeX}{\textrm{\Oldlatex}}
    % Document parameters
    % Document title
    \title{dac}
    
    
    
    
    
    
    
% Pygments definitions
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\@namedef{PY@tok@w}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\@namedef{PY@tok@c}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cp}{\def\PY@tc##1{\textcolor[rgb]{0.61,0.40,0.00}{##1}}}
\@namedef{PY@tok@k}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kt}{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\@namedef{PY@tok@o}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ow}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@nb}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nf}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@ne}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.80,0.25,0.22}{##1}}}
\@namedef{PY@tok@nv}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@no}{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\@namedef{PY@tok@nl}{\def\PY@tc##1{\textcolor[rgb]{0.46,0.46,0.00}{##1}}}
\@namedef{PY@tok@ni}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@na}{\def\PY@tc##1{\textcolor[rgb]{0.41,0.47,0.13}{##1}}}
\@namedef{PY@tok@nt}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nd}{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@s}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sd}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@si}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@se}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.36,0.12}{##1}}}
\@namedef{PY@tok@sr}{\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@ss}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sx}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@m}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@gh}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@gu}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\@namedef{PY@tok@gd}{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\@namedef{PY@tok@gi}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.52,0.00}{##1}}}
\@namedef{PY@tok@gr}{\def\PY@tc##1{\textcolor[rgb]{0.89,0.00,0.00}{##1}}}
\@namedef{PY@tok@ge}{\let\PY@it=\textit}
\@namedef{PY@tok@gs}{\let\PY@bf=\textbf}
\@namedef{PY@tok@ges}{\let\PY@bf=\textbf\let\PY@it=\textit}
\@namedef{PY@tok@gp}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@go}{\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@gt}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\@namedef{PY@tok@err}{\def\PY@bc##1{{\setlength{\fboxsep}{\string -\fboxrule}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}}
\@namedef{PY@tok@kc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kd}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kr}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@bp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@fm}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@vc}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vg}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vi}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vm}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sa}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sb}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sc}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@dl}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s2}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sh}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s1}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@mb}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mf}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mh}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mi}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@il}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mo}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ch}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cm}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cpf}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@c1}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cs}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % For linebreaks inside Verbatim environment from package fancyvrb.
    \makeatletter
        \newbox\Wrappedcontinuationbox
        \newbox\Wrappedvisiblespacebox
        \newcommand*\Wrappedvisiblespace {\textcolor{red}{\textvisiblespace}}
        \newcommand*\Wrappedcontinuationsymbol {\textcolor{red}{\llap{\tiny$\m@th\hookrightarrow$}}}
        \newcommand*\Wrappedcontinuationindent {3ex }
        \newcommand*\Wrappedafterbreak {\kern\Wrappedcontinuationindent\copy\Wrappedcontinuationbox}
        % Take advantage of the already applied Pygments mark-up to insert
        % potential linebreaks for TeX processing.
        %        {, <, #, %, $, ' and ": go to next line.
        %        _, }, ^, &, >, - and ~: stay at end of broken line.
        % Use of \textquotesingle for straight quote.
        \newcommand*\Wrappedbreaksatspecials {%
            \def\PYGZus{\discretionary{\char`\_}{\Wrappedafterbreak}{\char`\_}}%
            \def\PYGZob{\discretionary{}{\Wrappedafterbreak\char`\{}{\char`\{}}%
            \def\PYGZcb{\discretionary{\char`\}}{\Wrappedafterbreak}{\char`\}}}%
            \def\PYGZca{\discretionary{\char`\^}{\Wrappedafterbreak}{\char`\^}}%
            \def\PYGZam{\discretionary{\char`\&}{\Wrappedafterbreak}{\char`\&}}%
            \def\PYGZlt{\discretionary{}{\Wrappedafterbreak\char`\<}{\char`\<}}%
            \def\PYGZgt{\discretionary{\char`\>}{\Wrappedafterbreak}{\char`\>}}%
            \def\PYGZsh{\discretionary{}{\Wrappedafterbreak\char`\#}{\char`\#}}%
            \def\PYGZpc{\discretionary{}{\Wrappedafterbreak\char`\%}{\char`\%}}%
            \def\PYGZdl{\discretionary{}{\Wrappedafterbreak\char`\$}{\char`\$}}%
            \def\PYGZhy{\discretionary{\char`\-}{\Wrappedafterbreak}{\char`\-}}%
            \def\PYGZsq{\discretionary{}{\Wrappedafterbreak\textquotesingle}{\textquotesingle}}%
            \def\PYGZdq{\discretionary{}{\Wrappedafterbreak\char`\"}{\char`\"}}%
            \def\PYGZti{\discretionary{\char`\~}{\Wrappedafterbreak}{\char`\~}}%
        }
        % Some characters . , ; ? ! / are not pygmentized.
        % This macro makes them "active" and they will insert potential linebreaks
        \newcommand*\Wrappedbreaksatpunct {%
            \lccode`\~`\.\lowercase{\def~}{\discretionary{\hbox{\char`\.}}{\Wrappedafterbreak}{\hbox{\char`\.}}}%
            \lccode`\~`\,\lowercase{\def~}{\discretionary{\hbox{\char`\,}}{\Wrappedafterbreak}{\hbox{\char`\,}}}%
            \lccode`\~`\;\lowercase{\def~}{\discretionary{\hbox{\char`\;}}{\Wrappedafterbreak}{\hbox{\char`\;}}}%
            \lccode`\~`\:\lowercase{\def~}{\discretionary{\hbox{\char`\:}}{\Wrappedafterbreak}{\hbox{\char`\:}}}%
            \lccode`\~`\?\lowercase{\def~}{\discretionary{\hbox{\char`\?}}{\Wrappedafterbreak}{\hbox{\char`\?}}}%
            \lccode`\~`\!\lowercase{\def~}{\discretionary{\hbox{\char`\!}}{\Wrappedafterbreak}{\hbox{\char`\!}}}%
            \lccode`\~`\/\lowercase{\def~}{\discretionary{\hbox{\char`\/}}{\Wrappedafterbreak}{\hbox{\char`\/}}}%
            \catcode`\.\active
            \catcode`\,\active
            \catcode`\;\active
            \catcode`\:\active
            \catcode`\?\active
            \catcode`\!\active
            \catcode`\/\active
            \lccode`\~`\~
        }
    \makeatother

    \let\OriginalVerbatim=\Verbatim
    \makeatletter
    \renewcommand{\Verbatim}[1][1]{%
        %\parskip\z@skip
        \sbox\Wrappedcontinuationbox {\Wrappedcontinuationsymbol}%
        \sbox\Wrappedvisiblespacebox {\FV@SetupFont\Wrappedvisiblespace}%
        \def\FancyVerbFormatLine ##1{\hsize\linewidth
            \vtop{\raggedright\hyphenpenalty\z@\exhyphenpenalty\z@
                \doublehyphendemerits\z@\finalhyphendemerits\z@
                \strut ##1\strut}%
        }%
        % If the linebreak is at a space, the latter will be displayed as visible
        % space at end of first line, and a continuation symbol starts next line.
        % Stretch/shrink are however usually zero for typewriter font.
        \def\FV@Space {%
            \nobreak\hskip\z@ plus\fontdimen3\font minus\fontdimen4\font
            \discretionary{\copy\Wrappedvisiblespacebox}{\Wrappedafterbreak}
            {\kern\fontdimen2\font}%
        }%

        % Allow breaks at special characters using \PYG... macros.
        \Wrappedbreaksatspecials
        % Breaks at punctuation characters . , ; ? ! and / need catcode=\active
        \OriginalVerbatim[#1,codes*=\Wrappedbreaksatpunct]%
    }
    \makeatother

    % Exact colors from NB
    \definecolor{incolor}{HTML}{303F9F}
    \definecolor{outcolor}{HTML}{D84315}
    \definecolor{cellborder}{HTML}{CFCFCF}
    \definecolor{cellbackground}{HTML}{F7F7F7}

    % prompt
    \makeatletter
    \newcommand{\boxspacing}{\kern\kvtcb@left@rule\kern\kvtcb@boxsep}
    \makeatother
    \newcommand{\prompt}[4]{
        {\ttfamily\llap{{\color{#2}[#3]:\hspace{3pt}#4}}\vspace{-\baselineskip}}
    }
    

    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

\begin{document}
    
    % \maketitle
    
    

    
    \hypertarget{miniproject-3-7-bit-dac}{%
\section{Miniproject 3: 7-Bit DAC}\label{miniproject-3-7-bit-dac}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot} \PY{k}{as} \PY{n+nn}{plt}
\PY{k+kn}{import} \PY{n+nn}{numpy}
\PY{k+kn}{import} \PY{n+nn}{math}
\PY{k+kn}{import} \PY{n+nn}{sys}

\PY{k+kn}{from} \PY{n+nn}{IPython}\PY{n+nn}{.}\PY{n+nn}{display} \PY{k+kn}{import} \PY{n}{SVG}\PY{p}{,} \PY{n}{Image}\PY{p}{,} \PY{n}{Markdown}\PY{p}{,} \PY{n}{display}
\PY{k+kn}{from} \PY{n+nn}{pathlib} \PY{k+kn}{import} \PY{n}{Path}

\PY{k+kn}{from} \PY{n+nn}{util}\PY{n+nn}{.}\PY{n+nn}{simulation} \PY{k+kn}{import} \PY{p}{(}
    \PY{n}{get\PYZus{}project\PYZus{}root}\PY{p}{,}
    \PY{n}{get\PYZus{}netlist}\PY{p}{,}
    \PY{n}{run\PYZus{}simulation}\PY{p}{,}
    \PY{n}{parse\PYZus{}data}\PY{p}{,}
    \PY{n}{export\PYZus{}schematic}\PY{p}{,}
    \PY{n}{light\PYZus{}sea\PYZus{}green}\PY{p}{,}
    \PY{n}{bittersweet}\PY{p}{,}
    \PY{n}{black}\PY{p}{,}
\PY{p}{)}
\PY{k+kn}{from} \PY{n+nn}{util}\PY{n+nn}{.}\PY{n+nn}{dac} \PY{k+kn}{import} \PY{p}{(}
    \PY{n}{calculate\PYZus{}inl}\PY{p}{,}
    \PY{n}{calculate\PYZus{}dnl}\PY{p}{,}
    \PY{n}{adjust\PYZus{}m2m\PYZus{}ladder\PYZus{}tb\PYZus{}netlist}\PY{p}{,}
    \PY{n}{adjust\PYZus{}bias\PYZus{}gen\PYZus{}tb\PYZus{}netlist}\PY{p}{,}
    \PY{n}{run\PYZus{}monte\PYZus{}carlo}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} setup paths}
\PY{n}{project\PYZus{}root} \PY{o}{=} \PY{n}{get\PYZus{}project\PYZus{}root}\PY{p}{(}\PY{p}{)}
\PY{n}{analog\PYZus{}schematic\PYZus{}directory} \PY{o}{=} \PY{n}{project\PYZus{}root}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lib/analog/schematic}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{analog\PYZus{}symbol\PYZus{}directory} \PY{o}{=} \PY{n}{project\PYZus{}root}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lib/analog/symbol}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{mp\PYZus{}root} \PY{o}{=} \PY{n}{project\PYZus{}root}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{dac}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{sim\PYZus{}directory} \PY{o}{=} \PY{n}{mp\PYZus{}root}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{build}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{layout\PYZus{}directory} \PY{o}{=} \PY{n}{mp\PYZus{}root}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{layout}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{media\PYZus{}directory} \PY{o}{=} \PY{n}{mp\PYZus{}root}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{report/media}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{o}{\PYZpc{}}\PY{k}{load\PYZus{}ext} autoreload
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{dac-schematic-capture}{%
\subsection{DAC Schematic Capture}\label{dac-schematic-capture}}

    \hypertarget{m-2m-ladder}{%
\subsubsection{M-2M Ladder}\label{m-2m-ladder}}

The first component of a R-2R MOSFET-only DAC is M-2M ladder network to
divide an input current and sum currents based on the input digital
code. I created a ladder based on the work of Hammerschmied and Haung
{[}1{]}, shown below. For now, the transistor widths and lengths are
kept as variables.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{autoreload} 2
\PY{n}{m2m\PYZus{}ladder\PYZus{}schematic} \PY{o}{=} \PY{n}{analog\PYZus{}schematic\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder\PYZus{}pmos.sch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{m2m\PYZus{}ladder\PYZus{}symbol} \PY{o}{=} \PY{n}{analog\PYZus{}symbol\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder\PYZus{}pmos.sym}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{export\PYZus{}schematic}\PY{p}{(}\PY{n}{schematic}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder\PYZus{}pmos\PYZus{}sch.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{n}{export\PYZus{}schematic}\PY{p}{(}\PY{n}{schematic}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}symbol}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder\PYZus{}pmos\PYZus{}sym.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{SVG}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder\PYZus{}pmos\PYZus{}sym.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{SVG}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder\PYZus{}pmos\PYZus{}sch.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_4_0.pdf}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_4_1.pdf}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{m-2m-isat-vtc}{%
\subsubsection{M-2M Isat VTC}\label{m-2m-isat-vtc}}

With the M-2M ladder complete, I swept the gate voltage with the ladder
saturated to find the saturation current as a function of the gate
voltage. The M-2M ladder can be simplified down to single transistor of
width a multiple of 2 of the unit transistor, as shown below. Choosing a
bias current in moderate inversion may be advantageous for power and
bandwidth, though for completeness, the gate voltage can be swept across
all levels of inversion.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{21}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{autoreload} 2
\PY{n}{\PYZus{}2m\PYZus{}isat\PYZus{}isat\PYZus{}tb\PYZus{}schematic} \PY{o}{=} \PY{n}{mp\PYZus{}root}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{schematic/2m\PYZus{}isat\PYZus{}tb.sch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{export\PYZus{}schematic}\PY{p}{(}\PY{n}{schematic}\PY{o}{=}\PY{n}{\PYZus{}2m\PYZus{}isat\PYZus{}isat\PYZus{}tb\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{2m\PYZus{}isat\PYZus{}tb.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{SVG}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{2m\PYZus{}isat\PYZus{}tb.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_6_0.pdf}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{autoreload} 2
\PY{n}{m2m\PYZus{}ladder\PYZus{}isat\PYZus{}tb\PYZus{}schematic} \PY{o}{=} \PY{n}{mp\PYZus{}root}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{schematic/m2m\PYZus{}ladder\PYZus{}isat\PYZus{}tb.sch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{export\PYZus{}schematic}\PY{p}{(}\PY{n}{schematic}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}isat\PYZus{}tb\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder\PYZus{}isat.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{SVG}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder\PYZus{}isat.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_7_0.pdf}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{autoreload} 2
\PY{c+c1}{\PYZsh{} run 2m and m2m ladder saturation simulations}
\PY{n}{\PYZus{}2m\PYZus{}isat\PYZus{}sim\PYZus{}directory} \PY{o}{=} \PY{n}{sim\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{2m\PYZus{}isat}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{\PYZus{}2m\PYZus{}isat\PYZus{}netlist} \PY{o}{=} \PY{n}{get\PYZus{}netlist}\PY{p}{(}
    \PY{n}{schematic}\PY{o}{=}\PY{n}{\PYZus{}2m\PYZus{}isat\PYZus{}isat\PYZus{}tb\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{\PYZus{}2m\PYZus{}isat\PYZus{}sim\PYZus{}directory}
\PY{p}{)}
\PY{n}{\PYZus{}2m\PYZus{}isat\PYZus{}data\PYZus{}file} \PY{o}{=} \PY{n}{run\PYZus{}simulation}\PY{p}{(}
    \PY{n}{netlist}\PY{o}{=}\PY{n}{\PYZus{}2m\PYZus{}isat\PYZus{}netlist}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{\PYZus{}2m\PYZus{}isat\PYZus{}sim\PYZus{}directory}
\PY{p}{)}

\PY{n}{m2m\PYZus{}ladder\PYZus{}isat\PYZus{}sim\PYZus{}directory} \PY{o}{=} \PY{n}{sim\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder\PYZus{}isat}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{m2m\PYZus{}ladder\PYZus{}isat\PYZus{}netlist} \PY{o}{=} \PY{n}{get\PYZus{}netlist}\PY{p}{(}
    \PY{n}{schematic}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}isat\PYZus{}tb\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}isat\PYZus{}sim\PYZus{}directory}
\PY{p}{)}
\PY{n}{m2m\PYZus{}ladder\PYZus{}isat\PYZus{}data\PYZus{}file} \PY{o}{=} \PY{n}{run\PYZus{}simulation}\PY{p}{(}
    \PY{n}{netlist}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}isat\PYZus{}netlist}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}isat\PYZus{}sim\PYZus{}directory}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{autoreload} 2
\PY{n}{m2m\PYZus{}ladder\PYZus{}isat\PYZus{}data}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{parse\PYZus{}data}\PY{p}{(}\PY{n}{m2m\PYZus{}ladder\PYZus{}isat\PYZus{}data\PYZus{}file}\PY{p}{)}
\PY{n}{\PYZus{}2m\PYZus{}isat\PYZus{}data}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{parse\PYZus{}data}\PY{p}{(}\PY{n}{\PYZus{}2m\PYZus{}isat\PYZus{}data\PYZus{}file}\PY{p}{)}

\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{M\PYZhy{}2M Ladder Isat VTC}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Vgs (v)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Isat (A)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{n}{which}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{minor}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{}\PYZhy{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{minorticks\PYZus{}on}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{semilogy}\PY{p}{(}
    \PY{n}{m2m\PYZus{}ladder\PYZus{}isat\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{v\PYZhy{}sweep}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,}
    \PY{n}{m2m\PYZus{}ladder\PYZus{}isat\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{i(Vout)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,}
    \PY{n}{color}\PY{o}{=}\PY{n}{light\PYZus{}sea\PYZus{}green}\PY{p}{,}
    \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{semilogy}\PY{p}{(}
    \PY{n}{\PYZus{}2m\PYZus{}isat\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{v\PYZhy{}sweep}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,}
    \PY{n}{\PYZus{}2m\PYZus{}isat\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{i(Vout)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,}
    \PY{n}{color}\PY{o}{=}\PY{n}{bittersweet}\PY{p}{,}
    \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{M\PYZhy{}2M Ladder}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{2M}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
<matplotlib.legend.Legend at 0x7cdea1fd30e0>
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_9_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{ladder-current-selection}{%
\subsubsection{Ladder Current
Selection}\label{ladder-current-selection}}

With the saturation voltage in mind, I then swept the gate voltage of
the M-2M ladder and calculated the INL and DNL.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{autoreload} 2

\PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} M\PYZhy{}2M Ladder Optimization}
\PY{n}{inl\PYZus{}ranges} \PY{o}{=} \PY{p}{[}\PY{p}{]}
\PY{n}{dnl\PYZus{}ranges} \PY{o}{=} \PY{p}{[}\PY{p}{]}
\PY{n}{bias\PYZus{}currents} \PY{o}{=} \PY{p}{[}\PY{p}{]}
\PY{n}{gate\PYZus{}voltages} \PY{o}{=} \PY{p}{[}\PY{p}{]}

\PY{n}{index} \PY{o}{=} \PY{l+m+mi}{0}
\PY{n}{min\PYZus{}inl\PYZus{}range} \PY{o}{=} \PY{n}{sys}\PY{o}{.}\PY{n}{maxsize}
\PY{n}{min\PYZus{}dnl\PYZus{}range} \PY{o}{=} \PY{n}{sys}\PY{o}{.}\PY{n}{maxsize}
\PY{n}{min\PYZus{}inl\PYZus{}sim}\PY{p}{:} \PY{n}{Path}
\PY{n}{min\PYZus{}dnl\PYZus{}sim}\PY{p}{:} \PY{n}{Path}
\PY{n}{min\PYZus{}inl\PYZus{}index}\PY{p}{:} \PY{n+nb}{int}
\PY{n}{min\PYZus{}dnl\PYZus{}index}\PY{p}{:} \PY{n+nb}{int}

\PY{k}{for} \PY{n}{input\PYZus{}current}\PY{p}{,} \PY{n}{gate\PYZus{}voltage} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}\PY{n}{m2m\PYZus{}ladder\PYZus{}isat\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{i(Vout)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,} \PY{n}{m2m\PYZus{}ladder\PYZus{}isat\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{v\PYZhy{}sweep}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{)}\PY{p}{:}
  \PY{n}{m2m\PYZus{}ladder\PYZus{}sim\PYZus{}directory} \PY{o}{=} \PY{n}{sim\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
  \PY{n}{m2m\PYZus{}ladder\PYZus{}tb\PYZus{}schematic} \PY{o}{=} \PY{n}{mp\PYZus{}root}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{schematic/m2m\PYZus{}ladder\PYZus{}tb.sch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

  \PY{n}{m2m\PYZus{}ladder\PYZus{}netlist} \PY{o}{=} \PY{n}{get\PYZus{}netlist}\PY{p}{(}
      \PY{n}{schematic}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}tb\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}sim\PYZus{}directory}
  \PY{p}{)}

  \PY{n}{adjust\PYZus{}m2m\PYZus{}ladder\PYZus{}tb\PYZus{}netlist}\PY{p}{(}
      \PY{n}{file}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}netlist}\PY{p}{,} \PY{n}{i\PYZus{}in}\PY{o}{=}\PY{n}{input\PYZus{}current}\PY{p}{,} \PY{n}{v\PYZus{}gate}\PY{o}{=}\PY{n}{gate\PYZus{}voltage}
  \PY{p}{)}

  \PY{n}{m2m\PYZus{}ladder\PYZus{}data} \PY{o}{=} \PY{n}{run\PYZus{}simulation}\PY{p}{(}
      \PY{n}{netlist}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}netlist}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}sim\PYZus{}directory}\PY{p}{,} \PY{n}{filename}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder\PYZus{}}\PY{l+s+si}{\PYZob{}}\PY{n}{gate\PYZus{}voltage}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{.txt}\PY{l+s+s2}{\PYZdq{}}
  \PY{p}{)}

  \PY{n}{min\PYZus{}inl}\PY{p}{,} \PY{n}{max\PYZus{}inl}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{calculate\PYZus{}inl}\PY{p}{(}\PY{n}{file}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}data}\PY{p}{,} \PY{n}{input\PYZus{}current}\PY{o}{=}\PY{n}{input\PYZus{}current}\PY{p}{,} \PY{n}{suppress\PYZus{}plot}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
  \PY{n}{min\PYZus{}dnl}\PY{p}{,} \PY{n}{max\PYZus{}dnl}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{calculate\PYZus{}dnl}\PY{p}{(}\PY{n}{file}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}data}\PY{p}{,} \PY{n}{input\PYZus{}current}\PY{o}{=}\PY{n}{input\PYZus{}current}\PY{p}{,} \PY{n}{suppress\PYZus{}plot}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}

  \PY{n}{inl\PYZus{}ranges}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{max\PYZus{}inl} \PY{o}{\PYZhy{}} \PY{n}{min\PYZus{}inl}\PY{p}{)}
  \PY{n}{dnl\PYZus{}ranges}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{max\PYZus{}dnl} \PY{o}{\PYZhy{}} \PY{n}{min\PYZus{}dnl}\PY{p}{)}
  \PY{n}{bias\PYZus{}currents}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{input\PYZus{}current}\PY{p}{)}
  \PY{n}{gate\PYZus{}voltages}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{gate\PYZus{}voltage}\PY{p}{)}

  \PY{k}{if} \PY{n}{max\PYZus{}inl} \PY{o}{\PYZhy{}} \PY{n}{min\PYZus{}inl} \PY{o}{\PYZlt{}} \PY{n}{min\PYZus{}inl\PYZus{}range}\PY{p}{:}
    \PY{n}{min\PYZus{}inl\PYZus{}range} \PY{o}{=} \PY{n}{max\PYZus{}inl} \PY{o}{\PYZhy{}} \PY{n}{min\PYZus{}inl}
    \PY{n}{min\PYZus{}inl\PYZus{}sim} \PY{o}{=} \PY{n}{m2m\PYZus{}ladder\PYZus{}data}
    \PY{n}{min\PYZus{}inl\PYZus{}index} \PY{o}{=} \PY{n}{index}

  \PY{k}{if} \PY{n}{max\PYZus{}dnl} \PY{o}{\PYZhy{}} \PY{n}{min\PYZus{}dnl} \PY{o}{\PYZlt{}} \PY{n}{min\PYZus{}dnl\PYZus{}range}\PY{p}{:}
    \PY{n}{min\PYZus{}dnl\PYZus{}range} \PY{o}{=} \PY{n}{max\PYZus{}dnl} \PY{o}{\PYZhy{}} \PY{n}{min\PYZus{}dnl}
    \PY{n}{min\PYZus{}dnl\PYZus{}sim} \PY{o}{=} \PY{n}{m2m\PYZus{}ladder\PYZus{}data}
    \PY{n}{min\PYZus{}dnl\PYZus{}index} \PY{o}{=} \PY{n}{index}

  \PY{n}{index}\PY{o}{+}\PY{o}{=}\PY{l+m+mi}{1}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{34}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{M\PYZhy{}2M Ladder INL, DNL vs Id}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Bias Current (A)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{LSBs}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{n}{which}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{minor}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{}\PYZhy{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{minorticks\PYZus{}on}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}
    \PY{n}{bias\PYZus{}currents}\PY{p}{,}
    \PY{n}{inl\PYZus{}ranges}\PY{p}{,}
    \PY{n}{color}\PY{o}{=}\PY{n}{light\PYZus{}sea\PYZus{}green}\PY{p}{,}
    \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}
    \PY{n}{bias\PYZus{}currents}\PY{p}{,}
    \PY{n}{dnl\PYZus{}ranges}\PY{p}{,}
    \PY{n}{color}\PY{o}{=}\PY{n}{bittersweet}\PY{p}{,}
    \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{INL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{DNL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{34}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
<matplotlib.legend.Legend at 0x7cde9ba58190>
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_12_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{39}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{M\PYZhy{}2M Ladder INL, DNL vs Vgs}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Gate Voltage (V)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{LSBs}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{n}{which}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{minor}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{}\PYZhy{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{minorticks\PYZus{}on}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}
    \PY{n}{gate\PYZus{}voltages}\PY{p}{,}
    \PY{n}{inl\PYZus{}ranges}\PY{p}{,}
    \PY{n}{color}\PY{o}{=}\PY{n}{light\PYZus{}sea\PYZus{}green}\PY{p}{,}
    \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}
    \PY{n}{gate\PYZus{}voltages}\PY{p}{,}
    \PY{n}{dnl\PYZus{}ranges}\PY{p}{,}
    \PY{n}{color}\PY{o}{=}\PY{n}{bittersweet}\PY{p}{,}
    \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{INL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{DNL}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{39}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
<matplotlib.legend.Legend at 0x7cde9adb8410>
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_13_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{36}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{calculate\PYZus{}inl}\PY{p}{(}\PY{n}{file}\PY{o}{=}\PY{n}{min\PYZus{}inl\PYZus{}sim}\PY{p}{,} \PY{n}{input\PYZus{}current}\PY{o}{=}\PY{n}{bias\PYZus{}currents}\PY{p}{[}\PY{n}{min\PYZus{}inl\PYZus{}index}\PY{p}{]}\PY{p}{)}
\PY{n}{calculate\PYZus{}dnl}\PY{p}{(}\PY{n}{file}\PY{o}{=}\PY{n}{min\PYZus{}inl\PYZus{}sim}\PY{p}{,} \PY{n}{input\PYZus{}current}\PY{o}{=}\PY{n}{bias\PYZus{}currents}\PY{p}{[}\PY{n}{min\PYZus{}inl\PYZus{}index}\PY{p}{]}\PY{p}{)} \PY{c+c1}{\PYZsh{} purposefully use inl}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{36}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
(-0.18259912586774873, 1.2069193875795405)
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_14_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_14_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    Based on the results of the brute force simulation above, a gate voltage
of \(V_{gs} = 0.37V\) and ladder current of \(I_d = 3.4uA\) produces the
lowest INL. In the ``M-2M Ladder INL, DNL vs Vgs'' plot above, there are
two local minima - one at approximately \(V_{gs} = 0.37V\) and the other
at \(V_{gs} = 0.7V\). Although \(V_{gs} = 0.7V\) would result in lower
power consumption, INL and DNL remain flatter around \(V_{gs} = 0.37V\)
with variations in bias current. For that reason, \(V_{gs} = 0.37V\) was
selected as the target bias voltage for the ladder such that process
variations have a lower impact.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{77}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{target\PYZus{}vbp} \PY{o}{=} \PY{l+m+mf}{0.37}
\PY{n}{target\PYZus{}ladder\PYZus{}current} \PY{o}{=} \PY{l+m+mf}{3.425e\PYZhy{}6}
\PY{n}{target\PYZus{}bias\PYZus{}current} \PY{o}{=} \PY{n}{target\PYZus{}ladder\PYZus{}current} \PY{o}{/} \PY{l+m+mi}{2} \PY{c+c1}{\PYZsh{} divide by 2 due to ladder strength ratio of 2}
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{unit-transistor-dimensions}{%
\paragraph{Unit Transistor
Dimensions}\label{unit-transistor-dimensions}}

Because of short channel modulation, the length of the transistor should
ideally be greater than 4um {[}2{]}. I originally choose a transistor
size of 1/3, but increased to 4/12 to reduce short channel effects. With
the selected target ladder current above, the ladder and bia gen are
operating in moderate inversion. However, using a higher strength ratio
and operating in weak inversion would increase output impedance and
reduce short channel effect further. Unfortunately, I did not have time
to investigate high strength ratios in weak inversion.

    \hypertarget{supply-independent-bias-generation}{%
\subsubsection{Supply Independent Bias
Generation}\label{supply-independent-bias-generation}}

Supply independent bias generation can be achieved using the bia
generator show below.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{48}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{autoreload} 2
\PY{n}{bias\PYZus{}gen\PYZus{}schematic} \PY{o}{=} \PY{n}{analog\PYZus{}schematic\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{bias\PYZus{}gen.sch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{export\PYZus{}schematic}\PY{p}{(}\PY{n}{schematic}\PY{o}{=}\PY{n}{bias\PYZus{}gen\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{bias\PYZus{}gen.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{SVG}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{bias\PYZus{}gen.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_19_0.pdf}
    \end{center}
    { \hspace*{\fill} \\}
    
    Selection of the degeneration resistor R and strength of the bias gen
transistor can be calculated using the EKV model.

All transistors in the bias gen circuit operate in saturation, so
starting with \(I_{sat}\) of M2 and solving for \(V_{ds2}\):

\[I_b = I_s \log{1 + e^{\frac{\kappa (V_{ds2} - V_{T0})}{2U_{t}}}}\]

\[e^{\sqrt{\frac{I_b}{I_s}}} - 1 = e^{\frac{\kappa (V_{ds2} - V_{T0})}{2U_{t}}}\]

\[2U_t \log{e^{\sqrt{\frac{I_b}{I_s}}}-1} = \kappa (V_{ds2} - V_{T0})\]

\[V_{ds2} = \frac{2U_t}{\kappa} \log{e^{\sqrt{\frac{I_b}{I_s}}}-1} + V_{T0}\]

If V is the drain of the M5, M8, and M10, the current is:

\[I_b = M I_s \log{1 + e^{\frac{\kappa (V_{ds1} + V - V_{T0}) - V}{2U_{t}}}}\]

Because of the M1, M9 current mirror and because of the connection
between the drain and gate of M2, M5, M8, and M10:

\[V_{ds1} + V = V{ds2}\]

Substituting \(V_{ds2}\) for \(V_{ds1} + V\):

\[I_b = M I_s \log{1 + e^{\frac{\kappa \left(\frac{2U_t}{\kappa} \log{e^{\sqrt{\frac{I_b}{I_s}}}-1} + V_{T0} - V_{T0}\right) - V}{2U_{t}}}}\]

\[I_b = M I_s \log{1 + e^{\frac{\kappa \left(\frac{2U_t}{\kappa} \log{e^{\sqrt{\frac{I_b}{I_s}}}-1} \right) - V}{2U_{t}}}}\]

Solving for R:

\[R = \frac{2 U_t \log\left({e^{\frac{I_b}{I_s}} - 1}\right) - 2 U_t \log\left({e^{\frac{I_b}{I_s M}} - 1}\right)}{I_b}\]

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{49}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} bias gen degeneration resistor calculation}
\PY{n}{Ut} \PY{o}{=} \PY{l+m+mf}{25.86e\PYZhy{}3} \PY{c+c1}{\PYZsh{} volts, thermal voltage}
\PY{n}{Ib} \PY{o}{=} \PY{n}{target\PYZus{}bias\PYZus{}current}
\PY{n}{M} \PY{o}{=} \PY{l+m+mi}{3} \PY{c+c1}{\PYZsh{} degenerated mosfet strength}
\PY{n}{Is} \PY{o}{=} \PY{l+m+mf}{700e\PYZhy{}9} \PY{c+c1}{\PYZsh{} amps, specific current typ.}
\PY{n}{Vt0} \PY{o}{=} \PY{l+m+mf}{700e\PYZhy{}3} \PY{c+c1}{\PYZsh{} volts, threshold voltage typ.}
\PY{n}{k} \PY{o}{=} \PY{l+m+mf}{0.6} \PY{c+c1}{\PYZsh{} unitless, typ.}

\PY{n}{R} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{2} \PY{o}{*} \PY{n}{Ut} \PY{o}{*} \PY{n}{math}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{math}\PY{o}{.}\PY{n}{e}\PY{o}{*}\PY{o}{*}\PY{p}{(}\PY{n}{math}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{o}{*}\PY{n}{Ib}\PY{p}{)}\PY{o}{/}\PY{n}{Is}\PY{p}{)}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{l+m+mi}{2} \PY{o}{*} \PY{n}{Ut} \PY{o}{*} \PY{n}{math}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{math}\PY{o}{.}\PY{n}{e}\PY{o}{*}\PY{o}{*}\PY{p}{(}\PY{n}{math}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{o}{*}\PY{n}{Ib}\PY{p}{)}\PY{o}{/}\PY{p}{(}\PY{n}{M}\PY{o}{*}\PY{n}{Is}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)} \PY{o}{/} \PY{n}{Ib}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Degeneration resistor}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{R}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Degeneration resistor 39590.88741515288
    \end{Verbatim}

    Due to second order effects, calculation of the degeneration resistor is
not accurate enough to use on its own. Sweeping around the calculated
resistor allows for the selection of a resistor based on the output bias
voltage. The below testbench and simulation finds the best degeneration
resistor.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{73}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{autoreload} 2
\PY{n}{bias\PYZus{}gen\PYZus{}tb\PYZus{}schematic} \PY{o}{=} \PY{n}{mp\PYZus{}root}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{schematic/bias\PYZus{}gen\PYZus{}tb.sch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{export\PYZus{}schematic}\PY{p}{(}\PY{n}{schematic}\PY{o}{=}\PY{n}{bias\PYZus{}gen\PYZus{}tb\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{bias\PYZus{}gen\PYZus{}tb.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{SVG}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{bias\PYZus{}gen\PYZus{}tb.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_23_0.pdf}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{78}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{autoreload} 2

\PY{n}{candidate\PYZus{}resistors} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{35e3} \PY{o}{+} \PY{l+m+mf}{1e3} \PY{o}{*} \PY{n}{index} \PY{k}{for} \PY{n}{index} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{10}\PY{p}{)}\PY{p}{]}
\PY{n}{nmos\PYZus{}bias\PYZus{}voltages} \PY{o}{=} \PY{p}{[}\PY{p}{]}
\PY{n}{pmos\PYZus{}bias\PYZus{}voltages} \PY{o}{=} \PY{p}{[}\PY{p}{]}

\PY{n}{bias\PYZus{}gen\PYZus{}sim\PYZus{}directory} \PY{o}{=} \PY{n}{sim\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{bias\PYZus{}gen}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{bias\PYZus{}gen\PYZus{}netlist} \PY{o}{=} \PY{n}{get\PYZus{}netlist}\PY{p}{(}
    \PY{n}{schematic}\PY{o}{=}\PY{n}{bias\PYZus{}gen\PYZus{}tb\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{bias\PYZus{}gen\PYZus{}sim\PYZus{}directory}
\PY{p}{)}

\PY{k}{for} \PY{n}{resistor} \PY{o+ow}{in} \PY{n}{candidate\PYZus{}resistors}\PY{p}{:}
    \PY{n}{adjust\PYZus{}bias\PYZus{}gen\PYZus{}tb\PYZus{}netlist}\PY{p}{(}\PY{n}{file}\PY{o}{=}\PY{n}{bias\PYZus{}gen\PYZus{}netlist}\PY{p}{,} \PY{n}{u\PYZus{}w}\PY{o}{=}\PY{l+m+mi}{4}\PY{p}{,} \PY{n}{u\PYZus{}l}\PY{o}{=}\PY{l+m+mi}{12}\PY{p}{,} \PY{n}{mult}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{res}\PY{o}{=}\PY{n}{resistor}\PY{p}{)}

    \PY{n}{bias\PYZus{}gen\PYZus{}data\PYZus{}file} \PY{o}{=} \PY{n}{run\PYZus{}simulation}\PY{p}{(}
        \PY{n}{netlist}\PY{o}{=}\PY{n}{bias\PYZus{}gen\PYZus{}netlist}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{bias\PYZus{}gen\PYZus{}sim\PYZus{}directory}
    \PY{p}{)}
    \PY{n}{bias\PYZus{}gen\PYZus{}data}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{parse\PYZus{}data}\PY{p}{(}\PY{n}{bias\PYZus{}gen\PYZus{}data\PYZus{}file}\PY{p}{)}
    \PY{n}{nmos\PYZus{}bias\PYZus{}voltages}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{bias\PYZus{}gen\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{v(vbn)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
    \PY{n}{pmos\PYZus{}bias\PYZus{}voltages}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{bias\PYZus{}gen\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{v(vbp)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{79}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{ladder\PYZus{}pmos\PYZus{}bias\PYZus{}index} \PY{o}{=} \PY{n}{numpy}\PY{o}{.}\PY{n}{argmin}\PY{p}{(}\PY{n}{numpy}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{numpy}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{pmos\PYZus{}bias\PYZus{}voltages}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{target\PYZus{}vbp}\PY{p}{)}\PY{p}{)}

\PY{n+nb}{print}\PY{p}{(}
    \PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Preferred degeneration resistor: }\PY{l+s+si}{\PYZob{}}\PY{n}{candidate\PYZus{}resistors}\PY{p}{[}\PY{n}{ladder\PYZus{}pmos\PYZus{}bias\PYZus{}index}\PY{p}{]}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, voltage: }\PY{l+s+si}{\PYZob{}}\PY{n}{pmos\PYZus{}bias\PYZus{}voltages}\PY{p}{[}\PY{n}{ladder\PYZus{}pmos\PYZus{}bias\PYZus{}index}\PY{p}{]}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}
\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Bias Voltage vs Degeneration Resistance}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{DegenerationResistance (Ohms)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Bias Voltage (V)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{n}{which}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{minor}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{}\PYZhy{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{minorticks\PYZus{}on}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}
    \PY{n}{candidate\PYZus{}resistors}\PY{p}{,}
    \PY{n}{pmos\PYZus{}bias\PYZus{}voltages}\PY{p}{,}
    \PY{n}{color}\PY{o}{=}\PY{n}{bittersweet}\PY{p}{,}
    \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{hlines}\PY{p}{(}\PY{n}{target\PYZus{}vbp}\PY{p}{,} \PY{n}{candidate\PYZus{}resistors}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{candidate\PYZus{}resistors}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{}\PYZhy{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{n}{black}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Preferred degeneration resistor: 43000.0, voltage: 0.373003964
    \end{Verbatim}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{79}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
<matplotlib.collections.LineCollection at 0x772304623110>
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_25_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    A degeneration resistor of around \(42.6k\Omega\) created a bias voltage
of approximately 0.37V.

    \hypertarget{biased-m-2m-ladder}{%
\subsubsection{Biased M-2M Ladder}\label{biased-m-2m-ladder}}

With a supply independent bias generator and an M-2M ladder, I connected
both, then simulated and calculated the INL and DNL. As long as the
current source transistor and ladder remain in saturation, the INL and
DNL should be comparable to the ladder biased by an ideal current
source. Below is the test bench with the bias gen and ladder.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{105}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{autoreload} 2
\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}tb\PYZus{}schematic} \PY{o}{=} \PY{n}{mp\PYZus{}root}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{schematic/m2m\PYZus{}ladder\PYZus{}biased\PYZus{}tb.sch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{export\PYZus{}schematic}\PY{p}{(}\PY{n}{schematic}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}tb\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}tb.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{SVG}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}tb.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_28_0.pdf}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{75}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}sim\PYZus{}directory} \PY{o}{=} \PY{n}{sim\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder\PYZus{}biased}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}netlist} \PY{o}{=} \PY{n}{get\PYZus{}netlist}\PY{p}{(}
    \PY{n}{schematic}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}tb\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}sim\PYZus{}directory}
\PY{p}{)}

\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}data} \PY{o}{=} \PY{n}{run\PYZus{}simulation}\PY{p}{(}
    \PY{n}{netlist}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}netlist}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}sim\PYZus{}directory}
\PY{p}{)}
\PY{n}{calculate\PYZus{}inl}\PY{p}{(}\PY{n}{file}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}data}\PY{p}{,} \PY{n}{input\PYZus{}current}\PY{o}{=}\PY{n}{target\PYZus{}ladder\PYZus{}current}\PY{p}{)}
\PY{n}{calculate\PYZus{}dnl}\PY{p}{(}\PY{n}{file}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}data}\PY{p}{,} \PY{n}{input\PYZus{}current}\PY{o}{=}\PY{n}{target\PYZus{}ladder\PYZus{}current}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{75}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
(-0.19743813138686173, 1.2075463381021927)
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_29_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_29_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{current-mirror}{%
\subsubsection{Current Mirror}\label{current-mirror}}

Mirroring the current is important to increase the output impedance. I
selected the low-voltage stacked mirror, detailed in {[}3{]}.

Below is the current mirror schematic and testbench, then a test sweep
of the output voltage and current.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{78}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{autoreload} 2
\PY{n}{lvs\PYZus{}mirror\PYZus{}schematic} \PY{o}{=} \PY{n}{analog\PYZus{}schematic\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lvs\PYZus{}mirror.sch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{export\PYZus{}schematic}\PY{p}{(}\PY{n}{schematic}\PY{o}{=}\PY{n}{lvs\PYZus{}mirror\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lvs\PYZus{}mirror.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{SVG}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lvs\PYZus{}mirror.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_31_0.pdf}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{101}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{autoreload} 2
\PY{n}{lvs\PYZus{}mirror\PYZus{}tb\PYZus{}schematic} \PY{o}{=} \PY{n}{mp\PYZus{}root}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{schematic/lvs\PYZus{}mirror\PYZus{}tb.sch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{export\PYZus{}schematic}\PY{p}{(}\PY{n}{schematic}\PY{o}{=}\PY{n}{lvs\PYZus{}mirror\PYZus{}tb\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lvs\PYZus{}mirror\PYZus{}tb.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{SVG}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lvs\PYZus{}mirror\PYZus{}tb.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_32_0.pdf}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{100}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{lvs\PYZus{}mirror\PYZus{}sim\PYZus{}directory} \PY{o}{=} \PY{n}{sim\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{lvs\PYZus{}mirror}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

\PY{n}{lvs\PYZus{}mirror\PYZus{}netlist} \PY{o}{=} \PY{n}{get\PYZus{}netlist}\PY{p}{(}
    \PY{n}{schematic}\PY{o}{=}\PY{n}{lvs\PYZus{}mirror\PYZus{}tb\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{lvs\PYZus{}mirror\PYZus{}sim\PYZus{}directory}
\PY{p}{)}
\PY{n}{lvs\PYZus{}mirror\PYZus{}data} \PY{o}{=} \PY{n}{run\PYZus{}simulation}\PY{p}{(}
    \PY{n}{netlist}\PY{o}{=}\PY{n}{lvs\PYZus{}mirror\PYZus{}netlist}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{lvs\PYZus{}mirror\PYZus{}sim\PYZus{}directory}
\PY{p}{)}

\PY{n}{data}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{parse\PYZus{}data}\PY{p}{(}\PY{n}{lvs\PYZus{}mirror\PYZus{}data}\PY{p}{)}

\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{LVS Mirror Voltage\PYZhy{}Current Characteristics}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Vout (V)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Current (A)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{n}{which}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{minor}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{}\PYZhy{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{minorticks\PYZus{}on}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}
    \PY{n}{data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{v\PYZhy{}sweep}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,}
    \PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1} \PY{o}{*} \PY{n}{current} \PY{k}{for} \PY{n}{current} \PY{o+ow}{in} \PY{n}{data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{i(V2)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{]}\PY{p}{,}
    \PY{n}{color}\PY{o}{=}\PY{n}{light\PYZus{}sea\PYZus{}green}\PY{p}{,}
    \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{100}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
[<matplotlib.lines.Line2D at 0x7cde9932bc50>]
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_33_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{mirrored-dac}{%
\subsubsection{Mirrored DAC}\label{mirrored-dac}}

The low-voltage stacked mirror connected to the output of the M-2M
ladder. The INL and DNL can once again be checked with the addition of
the current mirror.

Importantly, for this test bench the current mirror is biased from an
ideal current source. A current divider will be added in a later
section.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{118}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{autoreload} 2
\PY{n}{m2m\PYZus{}ladder\PYZus{}pseudo\PYZus{}biased\PYZus{}mirrored\PYZus{}tb\PYZus{}schematic} \PY{o}{=} \PY{n}{mp\PYZus{}root}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{schematic/m2m\PYZus{}ladder\PYZus{}pseudo\PYZus{}biased\PYZus{}mirrored\PYZus{}tb.sch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{export\PYZus{}schematic}\PY{p}{(}\PY{n}{schematic}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}pseudo\PYZus{}biased\PYZus{}mirrored\PYZus{}tb\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder\PYZus{}pseudo\PYZus{}biased\PYZus{}mirrored\PYZus{}tb.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{SVG}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder\PYZus{}pseudo\PYZus{}biased\PYZus{}mirrored\PYZus{}tb.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_35_0.pdf}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{119}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{m2m\PYZus{}ladder\PYZus{}pseudo\PYZus{}biased\PYZus{}mirrored\PYZus{}sim\PYZus{}directory} \PY{o}{=} \PY{n}{sim\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder\PYZus{}pseudo\PYZus{}biased\PYZus{}mirrored}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

\PY{n}{m2m\PYZus{}ladder\PYZus{}psuedo\PYZus{}biased\PYZus{}mirrored\PYZus{}netlist} \PY{o}{=} \PY{n}{get\PYZus{}netlist}\PY{p}{(}
    \PY{n}{schematic}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}pseudo\PYZus{}biased\PYZus{}mirrored\PYZus{}tb\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}pseudo\PYZus{}biased\PYZus{}mirrored\PYZus{}sim\PYZus{}directory}
\PY{p}{)}

\PY{n}{m2m\PYZus{}ladder\PYZus{}psuedo\PYZus{}biased\PYZus{}mirrored\PYZus{}data} \PY{o}{=} \PY{n}{run\PYZus{}simulation}\PY{p}{(}
    \PY{n}{netlist}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}psuedo\PYZus{}biased\PYZus{}mirrored\PYZus{}netlist}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}pseudo\PYZus{}biased\PYZus{}mirrored\PYZus{}sim\PYZus{}directory}
\PY{p}{)}

\PY{n}{calculate\PYZus{}inl}\PY{p}{(}\PY{n}{file}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}psuedo\PYZus{}biased\PYZus{}mirrored\PYZus{}data}\PY{p}{,} \PY{n}{input\PYZus{}current}\PY{o}{=}\PY{n}{target\PYZus{}ladder\PYZus{}current}\PY{p}{)}
\PY{n}{calculate\PYZus{}dnl}\PY{p}{(}\PY{n}{file}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}psuedo\PYZus{}biased\PYZus{}mirrored\PYZus{}data}\PY{p}{,} \PY{n}{input\PYZus{}current}\PY{o}{=}\PY{n}{target\PYZus{}ladder\PYZus{}current}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{119}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
(-0.23826321751824886, 1.2058228040875898)
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_36_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_36_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{current-divider}{%
\subsubsection{Current Divider}\label{current-divider}}

The low voltage stacked mirror requires a bias current much smaller than
the input current - on the order of nAs is sufficient as shown in the
mirrored DAC simulation above. The bias current can be copied from the
bias generator, then divided with a M-2M ladder in much the same way as
the M-2M ladder.

Below is the current divider and its testbench, followed by a simulation
and its output current.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{123}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{autoreload} 2
\PY{n}{current\PYZus{}divider\PYZus{}schematic} \PY{o}{=} \PY{n}{analog\PYZus{}schematic\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{current\PYZus{}divider.sch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{export\PYZus{}schematic}\PY{p}{(}\PY{n}{schematic}\PY{o}{=}\PY{n}{current\PYZus{}divider\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{current\PYZus{}divider.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{SVG}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{current\PYZus{}divider.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_38_0.pdf}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{143}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{autoreload} 2
\PY{n}{current\PYZus{}divider\PYZus{}tb\PYZus{}schematic} \PY{o}{=} \PY{n}{mp\PYZus{}root}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{schematic/current\PYZus{}divider\PYZus{}tb.sch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{export\PYZus{}schematic}\PY{p}{(}\PY{n}{schematic}\PY{o}{=}\PY{n}{current\PYZus{}divider\PYZus{}tb\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{current\PYZus{}divider\PYZus{}tb.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{SVG}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{current\PYZus{}divider\PYZus{}tb.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_39_0.pdf}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{136}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{current\PYZus{}divider\PYZus{}sim\PYZus{}directory} \PY{o}{=} \PY{n}{sim\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{current\PYZus{}divider}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{current\PYZus{}divider\PYZus{}tb\PYZus{}schematic} \PY{o}{=} \PY{n}{mp\PYZus{}root}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{schematic/current\PYZus{}divider\PYZus{}tb.sch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

\PY{n}{current\PYZus{}divider\PYZus{}netlist} \PY{o}{=} \PY{n}{get\PYZus{}netlist}\PY{p}{(}
    \PY{n}{schematic}\PY{o}{=}\PY{n}{current\PYZus{}divider\PYZus{}tb\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{current\PYZus{}divider\PYZus{}sim\PYZus{}directory}
\PY{p}{)}

\PY{n}{current\PYZus{}divider\PYZus{}data} \PY{o}{=} \PY{n}{run\PYZus{}simulation}\PY{p}{(}
    \PY{n}{netlist}\PY{o}{=}\PY{n}{current\PYZus{}divider\PYZus{}netlist}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{current\PYZus{}divider\PYZus{}sim\PYZus{}directory}
\PY{p}{)}


\PY{n}{data}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{parse\PYZus{}data}\PY{p}{(}\PY{n}{current\PYZus{}divider\PYZus{}data}\PY{p}{)}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Current divider output: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{i(Vout)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Current divider output:  [9.6838384e-10]
    \end{Verbatim}

    \hypertarget{complete-dac}{%
\subsubsection{Complete DAC}\label{complete-dac}}

With the current divider complete, it can be added to the DAC and
simulated.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{138}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{autoreload} 2
\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}tb\PYZus{}schematic} \PY{o}{=} \PY{n}{mp\PYZus{}root}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{schematic/m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}tb.sch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{export\PYZus{}schematic}\PY{p}{(}\PY{n}{schematic}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}tb\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}tb.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{SVG}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}tb.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_42_0.pdf}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{142}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}sim\PYZus{}directory} \PY{o}{=} \PY{n}{sim\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}netlist} \PY{o}{=} \PY{n}{get\PYZus{}netlist}\PY{p}{(}
    \PY{n}{schematic}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}tb\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}sim\PYZus{}directory}
\PY{p}{)}

\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}data} \PY{o}{=} \PY{n}{run\PYZus{}simulation}\PY{p}{(}
    \PY{n}{netlist}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}netlist}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}sim\PYZus{}directory}
\PY{p}{)}

\PY{n}{calculate\PYZus{}inl}\PY{p}{(}\PY{n}{file}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}data}\PY{p}{,} \PY{n}{input\PYZus{}current}\PY{o}{=}\PY{n}{target\PYZus{}ladder\PYZus{}current}\PY{p}{)}
\PY{n}{calculate\PYZus{}dnl}\PY{p}{(}\PY{n}{file}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}data}\PY{p}{,} \PY{n}{input\PYZus{}current}\PY{o}{=}\PY{n}{target\PYZus{}ladder\PYZus{}current}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{142}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
(-0.23905737810219052, 1.2057907386861322)
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_43_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_43_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{mismatch}{%
\subsubsection{Mismatch}\label{mismatch}}

With a complete DAC, I simulated mismatch with a series of simulations
using the tt\_mm mismatch model in the sky130 PDK.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{delta\PYZus{}current\PYZus{}inls} \PY{o}{=} \PY{p}{[}\PY{p}{]}
\PY{n}{delta\PYZus{}current\PYZus{}dnls} \PY{o}{=} \PY{p}{[}\PY{p}{]}

\PY{k}{for} \PY{n}{\PYZus{}} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{10}\PY{p}{)}\PY{p}{:}
  \PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}mm\PYZus{}tb\PYZus{}schematic} \PY{o}{=} \PY{n}{mp\PYZus{}root}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{schematic/m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}mm\PYZus{}tb.sch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
  \PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}mm\PYZus{}sim\PYZus{}directory} \PY{o}{=} \PY{n}{sim\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}mm}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

  \PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}mm\PYZus{}netlist} \PY{o}{=} \PY{n}{get\PYZus{}netlist}\PY{p}{(}
      \PY{n}{schematic}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}mm\PYZus{}tb\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}mm\PYZus{}sim\PYZus{}directory}
  \PY{p}{)}

  \PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}mm\PYZus{}data} \PY{o}{=} \PY{n}{run\PYZus{}simulation}\PY{p}{(}
      \PY{n}{netlist}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}mm\PYZus{}netlist}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}mm\PYZus{}sim\PYZus{}directory}
  \PY{p}{)}

  \PY{n}{\PYZus{}}\PY{p}{,} \PY{n}{\PYZus{}}\PY{p}{,} \PY{n}{\PYZus{}}\PY{p}{,} \PY{n}{\PYZus{}}\PY{p}{,} \PY{n}{delta\PYZus{}current\PYZus{}inl} \PY{o}{=} \PY{n}{calculate\PYZus{}inl}\PY{p}{(}\PY{n}{file}\PY{o}{=} \PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}mm\PYZus{}data}\PY{p}{,} \PY{n}{input\PYZus{}current}\PY{o}{=}\PY{n}{target\PYZus{}ladder\PYZus{}current}\PY{p}{,} \PY{n}{suppress\PYZus{}plot}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
  \PY{n}{\PYZus{}}\PY{p}{,} \PY{n}{\PYZus{}}\PY{p}{,} \PY{n}{\PYZus{}}\PY{p}{,} \PY{n}{\PYZus{}}\PY{p}{,} \PY{n}{delta\PYZus{}current\PYZus{}dnl} \PY{o}{=} \PY{n}{calculate\PYZus{}dnl}\PY{p}{(}\PY{n}{file}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}mm\PYZus{}data}\PY{p}{,} \PY{n}{input\PYZus{}current}\PY{o}{=}\PY{n}{target\PYZus{}ladder\PYZus{}current}\PY{p}{)}

  \PY{n}{delta\PYZus{}current\PYZus{}inls}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{delta\PYZus{}current\PYZus{}inl}\PY{p}{)}
  \PY{n}{delta\PYZus{}current\PYZus{}dnls}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{delta\PYZus{}current\PYZus{}dnl}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
(-0.20312656350364533, 0.9943569751824821)
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_45_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_45_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{14}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{autoreload} 2
\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}mm\PYZus{}tb\PYZus{}schematic} \PY{o}{=} \PY{n}{mp\PYZus{}root}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{schematic/m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}mm\PYZus{}tb.sch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}mm\PYZus{}sim\PYZus{}directory} \PY{o}{=} \PY{n}{sim\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}mm}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

\PY{n}{run\PYZus{}monte\PYZus{}carlo}\PY{p}{(}\PY{n}{file}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}mm\PYZus{}tb\PYZus{}schematic}\PY{p}{,} \PY{n}{build\PYZus{}directory}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}biased\PYZus{}mirrored\PYZus{}mm\PYZus{}sim\PYZus{}directory}\PY{p}{,} \PY{n}{input\PYZus{}current}\PY{o}{=}\PY{n}{target\PYZus{}ladder\PYZus{}current}\PY{p}{,} \PY{n}{runs}\PY{o}{=}\PY{l+m+mi}{20}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_46_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_46_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{output-current-over-output-voltage}{%
\subsubsection{Output Current Over Output
Voltage}\label{output-current-over-output-voltage}}

The current mirror should ensure the output current remains constant
with changes in the output voltage as shown in the simulation of the
current mirror. Below are the testbench and results of sweeping the
output voltage vs the output current.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{33}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{autoreload} 2
\PY{n}{dac\PYZus{}output\PYZus{}voltage\PYZus{}tb\PYZus{}schematic} \PY{o}{=} \PY{n}{mp\PYZus{}root}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{schematic/dac\PYZus{}output\PYZus{}voltage\PYZus{}tb.sch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{export\PYZus{}schematic}\PY{p}{(}\PY{n}{schematic}\PY{o}{=}\PY{n}{dac\PYZus{}output\PYZus{}voltage\PYZus{}tb\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{dac\PYZus{}output\PYZus{}voltage\PYZus{}tb.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{SVG}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{dac\PYZus{}output\PYZus{}voltage\PYZus{}tb.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_48_0.pdf}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{34}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{dac\PYZus{}output\PYZus{}voltage\PYZus{}sim\PYZus{}directory} \PY{o}{=} \PY{n}{sim\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{dac\PYZus{}output\PYZus{}voltage}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

\PY{n}{dac\PYZus{}output\PYZus{}voltage\PYZus{}netlist} \PY{o}{=} \PY{n}{get\PYZus{}netlist}\PY{p}{(}
    \PY{n}{schematic}\PY{o}{=}\PY{n}{dac\PYZus{}output\PYZus{}voltage\PYZus{}tb\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{dac\PYZus{}output\PYZus{}voltage\PYZus{}sim\PYZus{}directory}
\PY{p}{)}

\PY{n}{dac\PYZus{}output\PYZus{}voltage\PYZus{}data} \PY{o}{=} \PY{n}{run\PYZus{}simulation}\PY{p}{(}
    \PY{n}{netlist}\PY{o}{=}\PY{n}{dac\PYZus{}output\PYZus{}voltage\PYZus{}netlist}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{dac\PYZus{}output\PYZus{}voltage\PYZus{}sim\PYZus{}directory}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{96}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{\PYZus{}dac\PYZus{}output\PYZus{}voltage\PYZus{}data}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{parse\PYZus{}data}\PY{p}{(}\PY{n}{dac\PYZus{}output\PYZus{}voltage\PYZus{}data}\PY{p}{)}

\PY{n}{slope} \PY{o}{=} \PY{p}{(}\PY{l+m+mf}{3.39433444e\PYZhy{}06} \PY{o}{\PYZhy{}} \PY{l+m+mf}{3.37291037e\PYZhy{}06} \PY{p}{)} \PY{o}{/} \PY{p}{(}\PY{l+m+mf}{1.8} \PY{o}{\PYZhy{}} \PY{l+m+mf}{0.36}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{n}{slope}\PY{p}{)}
\PY{n}{intercept} \PY{o}{=} \PY{p}{(}\PY{n}{slope} \PY{o}{*} \PY{l+m+mf}{1.8}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{l+m+mf}{3.39433444e\PYZhy{}06}

\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Output Current vs Output Voltage}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Output Voltage (V)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Output Current (A)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{n}{which}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{minor}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{}\PYZhy{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{minorticks\PYZus{}on}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{\PYZus{}dac\PYZus{}output\PYZus{}voltage\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{v\PYZhy{}sweep}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,} \PY{n}{\PYZus{}dac\PYZus{}output\PYZus{}voltage\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{i(Vout)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{n}{black}\PY{p}{,} \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{vlines}\PY{p}{(}\PY{l+m+mf}{1.8} \PY{o}{*} \PY{l+m+mf}{0.2}\PY{p}{,} \PY{l+m+mf}{3.6e\PYZhy{}6}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{}\PYZhy{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{n}{black}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{axline}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{o}{\PYZhy{}}\PY{n}{intercept}\PY{p}{)}\PY{p}{,} \PY{n}{slope} \PY{o}{=} \PY{n}{slope}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{}\PYZhy{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{n}{black}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
1.4877826388888731e-08
    \end{Verbatim}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{96}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
<matplotlib.lines.AxLine at 0x772306599810>
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_50_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    Over 80\% of the power supply voltage (0.36-1.8V), the output current
stays between 3.37uA-3.39uA, with a slope of 14.8nA/V or 0.44\%/V of the
3.425uA FSR.

    \hypertarget{output-current-over-power-supply-voltage}{%
\subsubsection{Output Current Over Power Supply
Voltage}\label{output-current-over-power-supply-voltage}}

    To test the output current over the power supply voltage, I tied all DAC
inputs to Vdd and swept the power supply voltage.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{102}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{autoreload} 2
\PY{n}{dac\PYZus{}supply\PYZus{}voltage\PYZus{}tb\PYZus{}schematic} \PY{o}{=} \PY{n}{mp\PYZus{}root}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{schematic/dac\PYZus{}supply\PYZus{}voltage\PYZus{}tb.sch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{export\PYZus{}schematic}\PY{p}{(}\PY{n}{schematic}\PY{o}{=}\PY{n}{dac\PYZus{}supply\PYZus{}voltage\PYZus{}tb\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{dac\PYZus{}supply\PYZus{}voltage\PYZus{}tb.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{SVG}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{dac\PYZus{}supply\PYZus{}voltage\PYZus{}tb.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_54_0.pdf}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{103}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{dac\PYZus{}supply\PYZus{}voltage\PYZus{}sim\PYZus{}directory} \PY{o}{=} \PY{n}{sim\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{dac\PYZus{}supply\PYZus{}voltage}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

\PY{n}{dac\PYZus{}supply\PYZus{}voltage\PYZus{}netlist} \PY{o}{=} \PY{n}{get\PYZus{}netlist}\PY{p}{(}
    \PY{n}{schematic}\PY{o}{=}\PY{n}{dac\PYZus{}supply\PYZus{}voltage\PYZus{}tb\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{dac\PYZus{}supply\PYZus{}voltage\PYZus{}sim\PYZus{}directory}
\PY{p}{)}

\PY{n}{dac\PYZus{}supply\PYZus{}voltage\PYZus{}data} \PY{o}{=} \PY{n}{run\PYZus{}simulation}\PY{p}{(}
    \PY{n}{netlist}\PY{o}{=}\PY{n}{dac\PYZus{}supply\PYZus{}voltage\PYZus{}netlist}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{dac\PYZus{}supply\PYZus{}voltage\PYZus{}sim\PYZus{}directory}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{104}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{\PYZus{}dac\PYZus{}supply\PYZus{}voltage\PYZus{}data}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{parse\PYZus{}data}\PY{p}{(}\PY{n}{dac\PYZus{}supply\PYZus{}voltage\PYZus{}data}\PY{p}{)}

\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Output Current vs Supply Voltage, R=42.6175k}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Supply Voltage (V)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Output Current (A)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{n}{which}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{minor}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{}\PYZhy{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{minorticks\PYZus{}on}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{\PYZus{}dac\PYZus{}supply\PYZus{}voltage\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{v\PYZhy{}sweep}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,} \PY{n}{\PYZus{}dac\PYZus{}supply\PYZus{}voltage\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{i(Vout)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{n}{black}\PY{p}{,} \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{104}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
[<matplotlib.lines.Line2D at 0x77230617b890>]
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_56_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    As can be seen from the output current as a function of the supply
voltage, my DAC is not even remotely supply-independent. I had not
realized and not tested the the supply-independence of the bias
generator.

I ran out of time to fully investigate, but increasing the bias
generator degeneration resistor to 100k and moving the bias generator
into weak inversion allows the bias generator to output a near constant
current around the supply voltage. All of the above simulations could be
rerun with a lower bias current to meet all DAC requirements.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{107}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{dac\PYZus{}supply\PYZus{}voltage\PYZus{}sim\PYZus{}directory} \PY{o}{=} \PY{n}{sim\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{dac\PYZus{}supply\PYZus{}voltage}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

\PY{n}{dac\PYZus{}supply\PYZus{}voltage\PYZus{}netlist} \PY{o}{=} \PY{n}{get\PYZus{}netlist}\PY{p}{(}
    \PY{n}{schematic}\PY{o}{=}\PY{n}{dac\PYZus{}supply\PYZus{}voltage\PYZus{}tb\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{dac\PYZus{}supply\PYZus{}voltage\PYZus{}sim\PYZus{}directory}
\PY{p}{)}

\PY{n}{dac\PYZus{}supply\PYZus{}voltage\PYZus{}data} \PY{o}{=} \PY{n}{run\PYZus{}simulation}\PY{p}{(}
    \PY{n}{netlist}\PY{o}{=}\PY{n}{dac\PYZus{}supply\PYZus{}voltage\PYZus{}netlist}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{dac\PYZus{}supply\PYZus{}voltage\PYZus{}sim\PYZus{}directory}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{108}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{\PYZus{}dac\PYZus{}supply\PYZus{}voltage\PYZus{}data}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{parse\PYZus{}data}\PY{p}{(}\PY{n}{dac\PYZus{}supply\PYZus{}voltage\PYZus{}data}\PY{p}{)}

\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Output Current vs Supply Voltage, R=100k}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Supply Voltage (V)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Output Current (A)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{n}{which}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{minor}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{}\PYZhy{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{minorticks\PYZus{}on}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{\PYZus{}dac\PYZus{}supply\PYZus{}voltage\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{v\PYZhy{}sweep}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,} \PY{n}{\PYZus{}dac\PYZus{}supply\PYZus{}voltage\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{i(Vout)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{n}{black}\PY{p}{,} \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{108}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
[<matplotlib.lines.Line2D at 0x7722feebd950>]
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_59_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{layout}{%
\subsection{Layout}\label{layout}}

For each subcircuit, I made small adjustments for layout. Most changes
were to the transistor widths such that they were not longer variables,
but for the current divider I rearranged transistors and added dummy
devices. Functionally, nothing was changed from the above simulations
except for the removal of the capacitors in the bias generator and the
current mirror. Each layout passes LVS and is free from DRC errors.

    \hypertarget{current-divider}{%
\subsubsection{Current Divider}\label{current-divider}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{4}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{autoreload} 2
\PY{n}{current\PYZus{}divider\PYZus{}layout\PYZus{}schematic} \PY{o}{=} \PY{n}{layout\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{current\PYZus{}divider/current\PYZus{}divider\PYZus{}layout.sch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{export\PYZus{}schematic}\PY{p}{(}\PY{n}{schematic}\PY{o}{=}\PY{n}{current\PYZus{}divider\PYZus{}layout\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{current\PYZus{}divider\PYZus{}layout\PYZus{}schematic.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{SVG}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{current\PYZus{}divider\PYZus{}layout\PYZus{}schematic.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{Image}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{current\PYZus{}divider\PYZus{}layout.png}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_62_0.pdf}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_62_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    Dummy devices were added on the outside of the current dividing
transistors, though admittedly, they would be better placed on both
sides the current dividing transistors, as the expense of more area. I
do not believe there is much merit to these dummy devices.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{9}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{with} \PY{n+nb}{open}\PY{p}{(}\PY{n}{layout\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{current\PYZus{}divider/lvs/current\PYZus{}divider.out}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)} \PY{k}{as} \PY{n}{current\PYZus{}divider\PYZus{}lvs}\PY{p}{:}
    \PY{n}{contents} \PY{o}{=} \PY{n}{current\PYZus{}divider\PYZus{}lvs}\PY{o}{.}\PY{n}{read}\PY{p}{(}\PY{p}{)}
    \PY{n}{display}\PY{p}{(}\PY{n}{Markdown}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{```text}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+si}{\PYZob{}}\PY{n}{contents}\PY{l+s+si}{\PYZcb{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{```}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{verbatim}
Circuit 1 cell sky130_fd_pr__pfet_01v8 and Circuit 2 cell sky130_fd_pr__pfet_01v8 are black boxes.
Equate elements:  no current cell.
Device classes sky130_fd_pr__pfet_01v8 and sky130_fd_pr__pfet_01v8 are equivalent.

Class current_divider_schematic.spice (0):  Merged 25 parallel devices.
Class current_divider_layout.spice (1):  Merged 39 parallel devices.
Subcircuit summary:
Circuit 1: current_divider_schematic.spice |Circuit 2: current_divider_layout.spice    
-------------------------------------------|-------------------------------------------
sky130_fd_pr__pfet_01v8 (67->28)           |sky130_fd_pr__pfet_01v8 (67->28)           
Number of devices: 28                      |Number of devices: 28                      
Number of nets: 17                         |Number of nets: 17                         
---------------------------------------------------------------------------------------
Netlists match uniquely with property errors.
sky130_fd_pr__pfet_01v8:M54 vs. sky130_fd_pr__pfet_01v8:1:
 W circuit1: "u_w"   circuit2: "4"   (exact match req'd)
 L circuit1: "u_l"   circuit2: "12"   (exact match req'd)
Cells have no pins;  pin matching not needed.
Device classes current_divider_schematic.spice and current_divider_layout.spice are equivalent.

Final result: Circuits match uniquely.
Property errors were found.

The following cells had property errors:
 current_divider_schematic.spice
\end{verbatim}

    
    \hypertarget{m-2m-ladder}{%
\subsubsection{M-2M Ladder}\label{m-2m-ladder}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{5}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{autoreload} 2
\PY{n}{m2m\PYZus{}ladder\PYZus{}layout\PYZus{}schematic} \PY{o}{=} \PY{n}{layout\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder/m2m\PYZus{}ladder\PYZus{}layout.sch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{export\PYZus{}schematic}\PY{p}{(}\PY{n}{schematic}\PY{o}{=}\PY{n}{m2m\PYZus{}ladder\PYZus{}layout\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder\PYZus{}layout\PYZus{}schematic.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{SVG}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder\PYZus{}layout\PYZus{}schematic.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{Image}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder\PYZus{}layout.png}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_66_0.pdf}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_66_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{3}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{with} \PY{n+nb}{open}\PY{p}{(}\PY{n}{layout\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{m2m\PYZus{}ladder/lvs/m2m\PYZus{}ladder.out}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)} \PY{k}{as} \PY{n}{m2m\PYZus{}ladder\PYZus{}lvs}\PY{p}{:}
    \PY{n}{contents} \PY{o}{=} \PY{n}{m2m\PYZus{}ladder\PYZus{}lvs}\PY{o}{.}\PY{n}{read}\PY{p}{(}\PY{p}{)}
    \PY{n}{display}\PY{p}{(}\PY{n}{Markdown}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{```text}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+si}{\PYZob{}}\PY{n}{contents}\PY{l+s+si}{\PYZcb{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{```}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{verbatim}
Circuit 1 cell sky130_fd_pr__nfet_01v8 and Circuit 2 cell sky130_fd_pr__nfet_01v8 are black boxes.
Equate elements:  no current cell.
Device classes sky130_fd_pr__nfet_01v8 and sky130_fd_pr__nfet_01v8 are equivalent.

Circuit 1 cell sky130_fd_pr__pfet_01v8 and Circuit 2 cell sky130_fd_pr__pfet_01v8 are black boxes.
Equate elements:  no current cell.
Device classes sky130_fd_pr__pfet_01v8 and sky130_fd_pr__pfet_01v8 are equivalent.
Flattening unmatched subcell inverter in circuit m2m_ladder_schematic.spice (1)(7 instances)

Class m2m_ladder_layout.spice (0):  Merged 8 parallel devices.
Subcircuit summary:
Circuit 1: m2m_ladder_layout.spice         |Circuit 2: m2m_ladder_schematic.spice      
-------------------------------------------|-------------------------------------------
sky130_fd_pr__pfet_01v8 (44->36)           |sky130_fd_pr__pfet_01v8 (44->36)           
sky130_fd_pr__nfet_01v8 (7)                |sky130_fd_pr__nfet_01v8 (7)                
Number of devices: 43                      |Number of devices: 43                      
Number of nets: 34                         |Number of nets: 34                         
---------------------------------------------------------------------------------------
Netlists match uniquely.
Cells have no pins;  pin matching not needed.
Device classes m2m_ladder_layout.spice and m2m_ladder_schematic.spice are equivalent.

Final result: Circuits match uniquely.
.
\end{verbatim}

    
    \hypertarget{bias-generator}{%
\subsubsection{Bias Generator}\label{bias-generator}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{11}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{autoreload} 2
\PY{n}{bias\PYZus{}gen\PYZus{}layout\PYZus{}schematic} \PY{o}{=} \PY{n}{layout\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{bias\PYZus{}gen/bias\PYZus{}gen\PYZus{}layout.sch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{export\PYZus{}schematic}\PY{p}{(}\PY{n}{schematic}\PY{o}{=}\PY{n}{bias\PYZus{}gen\PYZus{}layout\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{bias\PYZus{}gen\PYZus{}layout\PYZus{}schematic.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{SVG}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{bias\PYZus{}gen\PYZus{}layout\PYZus{}schematic.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{Image}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{bias\PYZus{}gen\PYZus{}layout.png}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_69_0.pdf}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_69_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{12}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{with} \PY{n+nb}{open}\PY{p}{(}\PY{n}{layout\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{bias\PYZus{}gen/lvs/bias\PYZus{}gen.out}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)} \PY{k}{as} \PY{n}{bias\PYZus{}gen\PYZus{}lvs}\PY{p}{:}
    \PY{n}{contents} \PY{o}{=} \PY{n}{bias\PYZus{}gen\PYZus{}lvs}\PY{o}{.}\PY{n}{read}\PY{p}{(}\PY{p}{)}
    \PY{n}{display}\PY{p}{(}\PY{n}{Markdown}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{```text}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+si}{\PYZob{}}\PY{n}{contents}\PY{l+s+si}{\PYZcb{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{```}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{verbatim}
Circuit 1 cell sky130_fd_pr__pfet_01v8 and Circuit 2 cell sky130_fd_pr__pfet_01v8 are black boxes.
Equate elements:  no current cell.
Device classes sky130_fd_pr__pfet_01v8 and sky130_fd_pr__pfet_01v8 are equivalent.

Circuit 1 cell sky130_fd_pr__nfet_01v8 and Circuit 2 cell sky130_fd_pr__nfet_01v8 are black boxes.
Equate elements:  no current cell.
Device classes sky130_fd_pr__nfet_01v8 and sky130_fd_pr__nfet_01v8 are equivalent.

Class bias_gen_layout.spice (0):  Merged 2 parallel devices.
Class bias_gen_schematic.spice (1):  Merged 2 parallel devices.
Subcircuit summary:
Circuit 1: bias_gen_layout.spice           |Circuit 2: bias_gen_schematic.spice        
-------------------------------------------|-------------------------------------------
sky130_fd_pr__pfet_01v8 (4)                |sky130_fd_pr__pfet_01v8 (4)                
sky130_fd_pr__nfet_01v8 (6->4)             |sky130_fd_pr__nfet_01v8 (6->4)             
Number of devices: 8                       |Number of devices: 8                       
Number of nets: 7                          |Number of nets: 7                          
---------------------------------------------------------------------------------------
Netlists match uniquely.
Cells have no pins;  pin matching not needed.
Device classes bias_gen_layout.spice and bias_gen_schematic.spice are equivalent.

Final result: Circuits match uniquely.
.
\end{verbatim}

    
    \hypertarget{current-mirror}{%
\subsubsection{Current Mirror}\label{current-mirror}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{15}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{autoreload} 2
\PY{n}{current\PYZus{}mirror\PYZus{}layout\PYZus{}schematic} \PY{o}{=} \PY{n}{layout\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{current\PYZus{}mirror/lvs\PYZus{}mirror\PYZus{}layout.sch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{export\PYZus{}schematic}\PY{p}{(}\PY{n}{schematic}\PY{o}{=}\PY{n}{current\PYZus{}mirror\PYZus{}layout\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{current\PYZus{}mirror\PYZus{}layout\PYZus{}schematic.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{SVG}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{current\PYZus{}mirror\PYZus{}layout\PYZus{}schematic.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{Image}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{current\PYZus{}mirror\PYZus{}layout.png}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_72_0.pdf}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_72_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{6}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{with} \PY{n+nb}{open}\PY{p}{(}\PY{n}{layout\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{current\PYZus{}mirror/lvs/current\PYZus{}mirror.out}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)} \PY{k}{as} \PY{n}{current\PYZus{}mirror\PYZus{}lvs}\PY{p}{:}
    \PY{n}{contents} \PY{o}{=} \PY{n}{current\PYZus{}mirror\PYZus{}lvs}\PY{o}{.}\PY{n}{read}\PY{p}{(}\PY{p}{)}
    \PY{n}{display}\PY{p}{(}\PY{n}{Markdown}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{```text}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+si}{\PYZob{}}\PY{n}{contents}\PY{l+s+si}{\PYZcb{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{```}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{verbatim}
Circuit 1 cell sky130_fd_pr__nfet_01v8 and Circuit 2 cell sky130_fd_pr__nfet_01v8 are black boxes.
Equate elements:  no current cell.
Device classes sky130_fd_pr__nfet_01v8 and sky130_fd_pr__nfet_01v8 are equivalent.

Subcircuit summary:
Circuit 1: current_mirror_layout.spice     |Circuit 2: current_mirror_schematic.spice  
-------------------------------------------|-------------------------------------------
sky130_fd_pr__nfet_01v8 (5)                |sky130_fd_pr__nfet_01v8 (5)                
Number of devices: 5                       |Number of devices: 5                       
Number of nets: 6                          |Number of nets: 6                          
---------------------------------------------------------------------------------------
Netlists match uniquely.
Cells have no pins;  pin matching not needed.
Device classes current_mirror_layout.spice and current_mirror_schematic.spice are equivalent.

Final result: Circuits match uniquely.
.
\end{verbatim}

    
    \hypertarget{complete-dac}{%
\subsubsection{Complete DAC}\label{complete-dac}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{7}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{o}{\PYZpc{}}\PY{k}{autoreload} 2
\PY{n}{dac\PYZus{}layout\PYZus{}schematic} \PY{o}{=} \PY{n}{layout\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{dac\PYZus{}layout.sch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{export\PYZus{}schematic}\PY{p}{(}\PY{n}{schematic}\PY{o}{=}\PY{n}{dac\PYZus{}layout\PYZus{}schematic}\PY{p}{,} \PY{n}{output}\PY{o}{=}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{dac\PYZus{}layout\PYZus{}schematic.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{SVG}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{dac\PYZus{}layout\PYZus{}schematic.svg}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{Image}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{dac\PYZus{}unexpanded.png}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{Image}\PY{p}{(}\PY{n}{media\PYZus{}directory}\PY{o}{.}\PY{n}{joinpath}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{dac.png}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_75_0.pdf}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_75_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{dac_files/dac_75_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{appendix-source-files}{%
\subsubsection{Appendix: Source Files}\label{appendix-source-files}}

All source files can be found at
\url{https://github.com/drewnotdrew/madvlsi}.


    % Add a bibliography block to the postdoc
    
    
    
\end{document}
